<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuity in Taxation - BIR Report</title>
    
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Import Map to tell the browser where to find React libraries -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "recharts": "https://esm.sh/recharts@2.12.0?external=react,react-dom",
        "lucide-react": "https://esm.sh/lucide-react@0.330.0?external=react,react-dom"
      }
    }
    </script>

    <!-- 3. Babel Standalone to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- 4. The Application Logic -->
    <script type="text/babel" data-type="module">
        import React, { useState, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceDot } from 'recharts';
        import { Calculator, ScrollText, CheckCircle2, TrendingUp, BookOpen, AlertCircle } from 'lucide-react';

        const App = () => {
            const [activeTab, setActiveTab] = useState('report');
            const [testIncome, setTestIncome] = useState(450000);

            // --- MATHEMATICAL LOGIC ---
            const calculateTax = (income) => {
                if (income <= 250000) return 0;
                if (income <= 400000) return (income - 250000) * 0.20;
                if (income <= 800000) return 30000 + (income - 400000) * 0.25;
                if (income <= 2000000) return 130000 + (income - 800000) * 0.30;
                if (income <= 8000000) return 490000 + (income - 2000000) * 0.32;
                return 2410000 + (income - 8000000) * 0.35;
            };

            // Generate data points for the graph
            const graphData = useMemo(() => {
                const points = [];
                for (let i = 0; i <= 3000000; i += 100000) {
                points.push({
                    income: i,
                    tax: calculateTax(i),
                    formattedIncome: (i / 1000000).toFixed(1) + 'M',
                    formattedTax: (calculateTax(i) / 1000).toFixed(0) + 'k'
                });
                }
                return points;
            }, []);

            const formatCurrency = (val) => {
                return new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(val);
            };

            return (
                <div className="min-h-screen font-sans text-slate-800 pb-12">
                {/* Header */}
                <header className="bg-blue-900 text-white shadow-lg">
                    <div className="max-w-5xl mx-auto px-6 py-8">
                    <div className="flex items-center space-x-3 mb-2">
                        <TrendingUp className="w-8 h-8 text-yellow-400" />
                        <h1 className="text-2xl md:text-3xl font-bold tracking-tight">Continuity in Taxation</h1>
                    </div>
                    <p className="text-blue-200 text-lg">Bureau of Internal Revenue (BIR) Public Information Report</p>
                    <p className="text-sm text-blue-300 mt-2">Subject: Evaluation of the TRAIN Law Income Tax Provision</p>
                    </div>
                </header>

                {/* Main Content */}
                <main className="max-w-5xl mx-auto px-6 py-8">
                    
                    {/* Navigation Tabs */}
                    <div className="flex space-x-4 mb-8 border-b border-slate-200 overflow-x-auto pb-1">
                    {['report', 'math', 'graph', 'proof'].map((tab) => (
                        <button
                        key={tab}
                        onClick={() => setActiveTab(tab)}
                        className={`pb-3 px-4 text-sm font-semibold capitalize whitespace-nowrap transition-colors ${
                            activeTab === tab 
                            ? 'text-blue-700 border-b-2 border-blue-700' 
                            : 'text-slate-500 hover:text-slate-700'
                        }`}
                        >
                        {tab === 'report' ? 'Report & Table' : 
                        tab === 'math' ? 'Piecewise Function' : 
                        tab === 'graph' ? 'Graph & Calculator' : 'Continuity Proof'}
                        </button>
                    ))}
                    </div>

                    {/* --- SECTION 1: REPORT & TABLE --- */}
                    {activeTab === 'report' && (
                    <div className="space-y-8 animate-in fade-in duration-500">
                        <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h2 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
                            <ScrollText className="w-5 h-5 mr-2" />
                            1. The New Income Tax Table (TRAIN Law)
                        </h2>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse min-w-[600px]">
                            <thead>
                                <tr className="bg-blue-50 border-b border-blue-100">
                                <th className="p-4 font-semibold text-blue-900">Annual Taxable Income</th>
                                <th className="p-4 font-semibold text-blue-900">Tax Rate</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100 text-sm md:text-base">
                                <tr><td className="p-4">Not over ₱250,000</td><td className="p-4">0%</td></tr>
                                <tr><td className="p-4">Over ₱250,000 but not over ₱400,000</td><td className="p-4">20% of the excess over ₱250,000</td></tr>
                                <tr><td className="p-4">Over ₱400,000 but not over ₱800,000</td><td className="p-4">₱30,000 + 25% of the excess over ₱400,000</td></tr>
                                <tr><td className="p-4">Over ₱800,000 but not over ₱2,000,000</td><td className="p-4">₱130,000 + 30% of the excess over ₱800,000</td></tr>
                                <tr><td className="p-4">Over ₱2,000,000 but not over ₱8,000,000</td><td className="p-4">₱490,000 + 32% of the excess over ₱2,000,000</td></tr>
                                <tr><td className="p-4">Over ₱8,000,000</td><td className="p-4">₱2,410,000 + 35% of the excess over ₱8,000,000</td></tr>
                            </tbody>
                            </table>
                        </div>
                        </section>

                        <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h2 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
                            <CheckCircle2 className="w-5 h-5 mr-2" />
                            2. Evaluation of the Tax Provision
                        </h2>
                        <div className="prose text-slate-600 max-w-none">
                            <p className="mb-4">
                            The new income tax table under the TRAIN Law represents a significant shift towards a simpler and more equitable tax system for Filipino taxpayers.
                            </p>
                            <ul className="list-disc pl-5 space-y-2">
                            <li>
                                <strong>Simplicity:</strong> Unlike the previous 1997 Tax Code which had complicated exemptions and outdated brackets, the TRAIN Law consolidates rates into clearer tiers. While it still requires calculation, the "exemption" is now built directly into the first bracket (₱250,000), removing the need for filing separate personal and additional exemptions.
                            </li>
                            <li>
                                <strong>Helpfulness to Taxpayers:</strong> The most impactful feature is the 0% tax rate for those earning ₱250,000 or below annually. This effectively increases the take-home pay of minimum wage earners and entry-level professionals, providing immediate financial relief. The progressive nature of the rates ensures that those with higher capacity to pay contribute more, which balances equity with revenue generation.
                            </li>
                            </ul>
                        </div>
                        </section>
                    </div>
                    )}

                    {/* --- SECTION 2: PIECEWISE FUNCTION --- */}
                    {activeTab === 'math' && (
                    <div className="space-y-8 animate-in fade-in duration-500">
                        <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h2 className="text-xl font-bold text-blue-900 mb-6 flex items-center">
                            <BookOpen className="w-5 h-5 mr-2" />
                            3. The Piecewise Function T(x)
                        </h2>
                        <p className="mb-6 text-slate-600">
                            Let <span className="font-serif italic font-bold">x</span> represent the annual taxable income in Philippine Pesos.<br/>
                            Let <span className="font-serif italic font-bold">T(x)</span> represent the total income tax due.
                        </p>
                        
                        <div className="bg-slate-900 text-slate-100 p-8 rounded-lg font-mono overflow-x-auto shadow-inner text-sm md:text-base">
                            <div className="flex items-center min-w-[700px]">
                            <span className="text-2xl mr-4 italic">T(x) = </span>
                            <div className="text-lg leading-loose">
                                <div className="flex">
                                <span className="text-4xl mr-4 text-slate-400">{`{`}</span>
                                <div className="flex flex-col space-y-4">
                                    <div className="flex gap-4">
                                    <span className="text-green-400 w-24">0</span> 
                                    <span className="text-slate-400">if</span> 
                                    <span>0 ≤ x ≤ 250,000</span>
                                    </div>
                                    <div className="flex gap-4">
                                    <span className="text-green-400 w-24">0.20(x - 250,000)</span> 
                                    <span className="text-slate-400">if</span> 
                                    <span>250,000 &lt; x ≤ 400,000</span>
                                    </div>
                                    <div className="flex gap-4">
                                    <span className="text-green-400 w-24">30,000 + 0.25(x - 400,000)</span> 
                                    <span className="text-slate-400">if</span> 
                                    <span>400,000 &lt; x ≤ 800,000</span>
                                    </div>
                                    <div className="flex gap-4">
                                    <span className="text-green-400 w-24">130,000 + 0.30(x - 800,000)</span> 
                                    <span className="text-slate-400">if</span> 
                                    <span>800,000 &lt; x ≤ 2,000,000</span>
                                    </div>
                                    <div className="flex gap-4">
                                    <span className="text-green-400 w-24">490,000 + 0.32(x - 2,000,000)</span> 
                                    <span className="text-slate-400">if</span> 
                                    <span>2,000,000 &lt; x ≤ 8,000,000</span>
                                    </div>
                                    <div className="flex gap-4">
                                    <span className="text-green-400 w-24">2,410,000 + 0.35(x - 8,000,000)</span> 
                                    <span className="text-slate-400">if</span> 
                                    <span>x &gt; 8,000,000</span>
                                    </div>
                                </div>
                                </div>
                            </div>
                            </div>
                        </div>

                        <div className="mt-8">
                            <h3 className="font-semibold text-lg text-blue-900 mb-4">Table of Values (Sample Points)</h3>
                            <div className="border rounded-lg overflow-hidden">
                            <table className="w-full text-center">
                                <thead className="bg-slate-100 border-b">
                                <tr>
                                    <th className="p-3">Income (x)</th>
                                    <th className="p-3">Calculation</th>
                                    <th className="p-3">Tax (T(x))</th>
                                </tr>
                                </thead>
                                <tbody className="divide-y text-sm">
                                <tr>
                                    <td className="p-3 font-medium">₱150,000</td>
                                    <td className="p-3 text-slate-500">Below 250k threshold</td>
                                    <td className="p-3 font-bold text-green-600">₱0.00</td>
                                </tr>
                                <tr>
                                    <td className="p-3 font-medium">₱300,000</td>
                                    <td className="p-3 text-slate-500">0.20(300k - 250k)</td>
                                    <td className="p-3 font-bold text-blue-600">₱10,000.00</td>
                                </tr>
                                <tr>
                                    <td className="p-3 font-medium">₱500,000</td>
                                    <td className="p-3 text-slate-500">30k + 0.25(500k - 400k)</td>
                                    <td className="p-3 font-bold text-blue-600">₱55,000.00</td>
                                </tr>
                                <tr>
                                    <td className="p-3 font-medium">₱1,000,000</td>
                                    <td className="p-3 text-slate-500">130k + 0.30(1M - 800k)</td>
                                    <td className="p-3 font-bold text-blue-600">₱190,000.00</td>
                                </tr>
                                </tbody>
                            </table>
                            </div>
                        </div>
                        </section>
                    </div>
                    )}

                    {/* --- SECTION 3: GRAPH & CALCULATOR --- */}
                    {activeTab === 'graph' && (
                    <div className="space-y-6 animate-in fade-in duration-500">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {/* GRAPH AREA */}
                        <section className="md:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h2 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
                            <TrendingUp className="w-5 h-5 mr-2" />
                            4. Graph of the Function
                            </h2>
                            <div className="h-[400px] w-full bg-slate-50 rounded-lg p-4 border border-slate-100">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={graphData} margin={{ top: 20, right: 30, left: 40, bottom: 20 }}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                <XAxis 
                                    dataKey="income" 
                                    tickFormatter={(val) => `₱${val/1000000}M`}
                                    label={{ value: 'Annual Income (x)', position: 'insideBottomRight', offset: -10 }} 
                                />
                                <YAxis 
                                    tickFormatter={(val) => `₱${val/1000}k`}
                                    label={{ value: 'Tax Due (T(x))', angle: -90, position: 'insideLeft' }}
                                />
                                <Tooltip 
                                    formatter={(value) => formatCurrency(value)}
                                    labelFormatter={(label) => `Income: ${formatCurrency(label)}`}
                                    contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                                />
                                <Line 
                                    type="monotone" 
                                    dataKey="tax" 
                                    stroke="#2563eb" 
                                    strokeWidth={3} 
                                    dot={false}
                                    activeDot={{ r: 8 }}
                                />
                                <ReferenceDot x={250000} y={0} r={4} fill="red" stroke="none" />
                                <ReferenceDot x={400000} y={30000} r={4} fill="red" stroke="none" />
                                <ReferenceDot x={800000} y={130000} r={4} fill="red" stroke="none" />
                                <ReferenceDot x={2000000} y={490000} r={4} fill="red" stroke="none" />
                                </LineChart>
                            </ResponsiveContainer>
                            <p className="text-xs text-center text-slate-400 mt-2">*Graph scaled up to 3M income for visibility. The linear trend continues upwards.</p>
                            </div>
                        </section>

                        {/* CALCULATOR AREA */}
                        <section className="bg-blue-900 text-white p-6 rounded-xl shadow-lg flex flex-col">
                            <h2 className="text-xl font-bold mb-6 flex items-center">
                            <Calculator className="w-5 h-5 mr-2" />
                            Tax Calculator
                            </h2>
                            <div className="flex-1 flex flex-col justify-center space-y-6">
                            <div>
                                <label className="block text-blue-200 text-sm font-medium mb-2">Enter Annual Income:</label>
                                <div className="relative">
                                <span className="absolute left-3 top-3 text-slate-500">₱</span>
                                <input 
                                    type="number"
                                    value={testIncome}
                                    onChange={(e) => setTestIncome(Number(e.target.value))}
                                    className="w-full p-3 pl-8 rounded-lg text-slate-900 font-bold focus:ring-2 focus:ring-yellow-400 outline-none"
                                />
                                </div>
                            </div>
                            
                            <div className="bg-blue-800 p-6 rounded-lg text-center border border-blue-700">
                                <p className="text-blue-300 text-sm mb-1">Total Tax Due</p>
                                <p className="text-3xl font-bold text-yellow-400">
                                {formatCurrency(calculateTax(testIncome))}
                                </p>
                            </div>
                            
                            <div className="text-xs text-blue-300 text-center">
                                This interactive element demonstrates that the function produces a unique, defined output for any valid input x.
                            </div>
                            </div>
                        </section>
                        </div>
                    </div>
                    )}

                    {/* --- SECTION 4: CONTINUITY PROOF --- */}
                    {activeTab === 'proof' && (
                    <div className="space-y-8 animate-in fade-in duration-500">
                        <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h2 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
                            <AlertCircle className="w-5 h-5 mr-2" />
                            5. Continuity Analysis & Proof
                        </h2>
                        
                        <div className="prose text-slate-700 max-w-none">
                            <p className="mb-4">
                            <strong>Definition of Continuity:</strong> A function f(x) is continuous at a point c if:
                            </p>
                            <ol className="list-decimal pl-5 mb-6 space-y-1 bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <li>f(c) is defined.</li>
                            <li>The limit of f(x) as x approaches c exists (meaning Left Limit = Right Limit).</li>
                            <li>The limit of f(x) as x approaches c is equal to f(c).</li>
                            </ol>

                            <p className="mb-4">
                            The tax function is composed of linear polynomial functions, which are continuous everywhere in their respective domains. Therefore, we only need to test continuity at the <strong>boundary points</strong> ("knots"): 250,000, 400,000, 800,000, 2,000,000, and 8,000,000.
                            </p>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            {/* Proof 1 */}
                            <div className="border border-slate-200 rounded-lg p-5">
                                <h3 className="font-bold text-blue-800 mb-2 border-b pb-2">Case 1: x = 250,000</h3>
                                <div className="space-y-2 text-sm font-mono">
                                <p><span className="text-slate-500">Left Limit:</span> 0</p>
                                <p><span className="text-slate-500">Right Limit:</span> 0.20(250,000 - 250,000) = 0</p>
                                <p><span className="text-slate-500">Function Value f(c):</span> 0</p>
                                <p className="text-green-600 font-bold mt-2">Conclusion: Continuous ✓</p>
                                </div>
                            </div>

                            {/* Proof 2 */}
                            <div className="border border-slate-200 rounded-lg p-5">
                                <h3 className="font-bold text-blue-800 mb-2 border-b pb-2">Case 2: x = 400,000</h3>
                                <div className="space-y-2 text-sm font-mono">
                                <p><span className="text-slate-500">Left Limit:</span> 0.20(400,000 - 250,000) = 30,000</p>
                                <p><span className="text-slate-500">Right Limit:</span> 30,000 + 0.25(400,000 - 400,000) = 30,000</p>
                                <p><span className="text-slate-500">Function Value f(c):</span> 30,000</p>
                                <p className="text-green-600 font-bold mt-2">Conclusion: Continuous ✓</p>
                                </div>
                            </div>

                            {/* Proof 3 */}
                            <div className="border border-slate-200 rounded-lg p-5">
                                <h3 className="font-bold text-blue-800 mb-2 border-b pb-2">Case 3: x = 800,000</h3>
                                <div className="space-y-2 text-sm font-mono">
                                <p><span className="text-slate-500">Left Limit:</span> 30,000 + 0.25(800,000 - 400,000) = 130,000</p>
                                <p><span className="text-slate-500">Right Limit:</span> 130,000 + 0.30(800,000 - 800,000) = 130,000</p>
                                <p className="text-slate-500">Result: 130,000 = 130,000</p>
                                <p className="text-green-600 font-bold mt-2">Conclusion: Continuous ✓</p>
                                </div>
                            </div>

                            {/* Proof 4 */}
                            <div className="border border-slate-200 rounded-lg p-5">
                                <h3 className="font-bold text-blue-800 mb-2 border-b pb-2">Case 4: x = 2,000,000</h3>
                                <div className="space-y-2 text-sm font-mono">
                                <p><span className="text-slate-500">Left Limit:</span> 130,000 + 0.30(2,000,000 - 800,000) = 490,000</p>
                                <p><span className="text-slate-500">Right Limit:</span> 490,000 + 0.32(2M - 2M) = 490,000</p>
                                <p className="text-slate-500">Result: 490,000 = 490,000</p>
                                <p className="text-green-600 font-bold mt-2">Conclusion: Continuous ✓</p>
                                </div>
                            </div>
                            </div>

                            <div className="mt-8 bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 className="font-bold text-green-800">Final Conclusion</h4>
                            <p className="text-green-900 mt-1">
                                Since the left-hand limit equals the right-hand limit and equals the function value at every boundary point, <strong>the Income Tax Piecewise Function is continuous over the entire domain [0, ∞)</strong>. This ensures there are no sudden "jumps" in tax owed—a person earning ₱1.00 more than a bracket threshold only pays the higher rate on that single peso, not their entire income.
                            </p>
                            </div>

                        </div>
                        </section>
                    </div>
                    )}

                </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>